# 类加载过程

## 类的生命周期
~~~
加载      --      连接      --      初始化     --      使用      --      卸载

连接分为：验证     准备      解析
~~~

## 类加载过程

### 加载
~~~
类加载过程的第一步,主要完成下面3件事：
    （1）：通过全类名获取定义此类的二进制字节流
    （2）：将字节流所代表的的静态存储结构转化为方法区的运行时数据结构
    （3）：在内存中生成一个代表该类的Class对象,作为方法区这些数据的访问入口
一个非数组类的加载阶段(加载阶段获取类的二进制字节流的动作)是可控性最强的阶段,这一步可以自定义类加载器去控制
字节流的获取方式(重写一个类的loadClass()方法)。数组类型不通过类加载器创建,它由Java虚拟机直接创建

加载阶段和连接阶段的部分内容是交叉进行的，加载阶段尚未结束，连接阶段可能就已经开始了。
~~~

### 验证
~~~
文件格式验证： 验证字节流是否符合Class文件格式的规范，
    例如：是否以0xCAFEBABE开头、主次版本号是否在当前虚拟机的处理范围之内、常量池中的常量是否有不支持的类型。

元数据验证： 对字节码描述的信息进行语义分析（注意：对比javac编译阶段的语义分析）,以保证其描述的信息符合Java语言规范的要求。
    例如：这个类是否有父类,除java.lang.Object之外所有类都有父类、这个类是否继承了不允许继承的类（被final修饰的类）。

字节码验证： 最复杂的一个阶段。通过数据流和控制流分析,确定程序语义是合法的、符合逻辑。
    比如： 保证任意时刻操作数栈和指令代码序列能配合工作。

符号引用验证： 确保解析动作能正确执行。
~~~

### 准备
~~~
准备阶段是正式为类变量分配内存并设置类变量初始值的阶段,这些内存都将在方法区中分配
1.这时候进行内存分配的仅包含类变量(static),而不包含实例变量,实例变量会在对象实例化时随着对象一块分配在java堆上。
2.这里所设置的初始值"通常情况"下是数据类型的默认的零值（如 0、0L、false等）,
    比如我们定义public static int value = 111；那么value变量在准备阶段的初始值就是0而不是111（初始化阶段才会赋值）
    特殊情况：比如给value变量加上final关键字 public static final int value = 111,那么准备阶段vlaue的值就被赋值为111
~~~

### 解析
~~~
~~~

### 初始化
~~~
~~~

### 卸载
~~~
~~~